<?php
/**
 * Mageplaza
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Mageplaza.com license that is
 * available through the world-wide-web at this URL:
 * https://www.mageplaza.com/LICENSE.txt
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @category    Mageplaza
 * @package     Mageplaza_PdfInvoice
 * @copyright   Copyright (c) Mageplaza (http://www.mageplaza.com/)
 * @license     https://www.mageplaza.com/LICENSE.txt
 */

use Hyva\Theme\Model\ViewModelRegistry;
use Hyva\Theme\ViewModel\HeroiconsOutline;
use Magento\Framework\Escaper;
use Mageplaza\PdfInvoice\Block\Hyva\Creditmemo\Items;
use Mageplaza\PdfInvoice\Model\Source\PrintButton;

/** @var Escaper $escaper */
/** @var Items $block */
/** @var ViewModelRegistry $viewModels */

/** @var HeroiconsOutline $heroicons */
$heroicons = $viewModels->require(HeroiconsOutline::class);

$order = $block->getOrder();
?>
<?php foreach ($order->getCreditmemosCollection() as $creditmemo): ?>
    <div class="order-title md:text-left font-semibold">
        <?= $escaper->escapeHtml(__('Refund #')) ?>
        <?= $escaper->escapeHtml($creditmemo->getIncrementId()) ?>
        <?php [$url, $showCustomPrint, $label] = $block->getPrintBtnInfo($creditmemo) ?>
        <?php if ($showCustomPrint != PrintButton::CUSTOM_PDF) : ?>
            <a href="<?= $escaper->escapeUrl($block->getPrintCreditmemoUrl($creditmemo)) ?>"
               class="text-primary inline-block ml-2 pl-2 border-l text-sm font-normal"
                target="_blank"
                rel="noopener">
                <?= $heroicons->printerHtml('inline-block', 20, 20); ?>
                <span class="inline-block ml-1 underline">
                    <?= $escaper->escapeHtml(__('Print Refund')) ?>
                </span>
            </a>
        <?php endif; ?>
        <?php if ($showCustomPrint != PrintButton::DEFAULT_CORE) : ?>
            <a href="<?= $escaper->escapeUrl($url) ?>"
               class="action print text-primary inline-block ml-2 pl-2 border-l text-sm font-normal"
               rel="noopener">
                <span class="inline-block ml-1 underline"><?= $escaper->escapeHtml(__($label)) ?></span>
            </a>
        <?php endif; ?>
    </div>

    <?= $block->getCommentsHtml($creditmemo) ?>

    <div class="order-items creditmemo">
        <div class="hidden lg:grid grid-cols-7 text-sm text-secondary ">
            <div class="p-2 col-span-2"><?= $escaper->escapeHtml(__('Product Name')) ?></div>
            <div class="p-2"><?= $escaper->escapeHtml(__('Price')) ?></div>
            <div class="p-2"><?= $escaper->escapeHtml(__('Qty')) ?></div>
            <div class="p-2 text-right"><?= $escaper->escapeHtml(__('Subtotal')) ?></div>
            <div class="p-2 text-right"><?= $escaper->escapeHtml(__('Discount Amount')) ?></div>
            <div class="p-2 text-right"><?= $escaper->escapeHtml(__('Row Total')) ?></div>
        </div>
        <?php $items = $creditmemo->getAllItems(); ?>
        <?php foreach ($items as $item): ?>
            <?php if (!$item->getOrderItem()->getParentItem()): ?>
                <?= $block->getItemHtml($item) ?>
            <?php endif; ?>
        <?php endforeach; ?>
        <div class="flex justify-end border-t border-container">
            <div class="lg:w-1/3">
                <div class="grid grid-cols-2 text-right p-2 gap-2">
                    <?= $block->getTotalsHtml($creditmemo) ?>
                </div>
            </div>
        </div>
    </div>
<?php endforeach; ?>
